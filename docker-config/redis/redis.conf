# Redis configuration file for PetPro
# Enhanced for production use

# NETWORK SETTINGS
bind 0.0.0.0
port 6379
tcp-backlog 511
tcp-keepalive 300

# MEMORY MANAGEMENT
# Adjust based on available memory - 512MB for production
maxmemory 512mb
# Use volatile-lru for caches with TTL, allkeys-lru if all keys have TTL
maxmemory-policy volatile-lru
# Enable active memory defragmentation to optimize memory usage
activedefrag yes
active-defrag-threshold-lower 10
active-defrag-threshold-upper 100
active-defrag-cycle-min 25
active-defrag-cycle-max 75

# PERSISTENCE SETTINGS
# RDB persistence for regular snapshots
dbfilename dump.rdb
dir /data
rdbcompression yes
rdbchecksum yes
stop-writes-on-bgsave-error yes
# Save snapshots after specified time periods
save 900 1    # After 15 min if at least 1 key changed
save 300 10   # After 5 min if at least 10 keys changed
save 60 10000 # After 1 min if at least 10k keys changed

# AOF persistence for durability
appendonly yes
appendfilename "appendonly.aof"
# Use everysec for good performance with reasonable durability
appendfsync everysec
# Automatic rewriting of AOF file
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# SECURITY SETTINGS
# Uncomment and set real password in production
# requirepass ${REDIS_PASSWORD}
protected-mode yes

# LAZY FREEING
# Use asynchronous deletion for large objects to prevent blocking
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes
replica-lazy-flush yes

# CLIENTS
# Maximum connected clients (default: 10000)
maxclients 10000

# ADVANCED SETTINGS
# Multiple databases support (0-15)
databases 16

# MONITORING & DEBUGGING
# Latency monitoring
latency-monitor-threshold 100
# Slow log settings (microseconds)
slowlog-log-slower-than 10000
slowlog-max-len 128
# Command logging level
loglevel notice

# SNAPSHOTTING TUNING
no-appendfsync-on-rewrite yes

# I/O THREADS (Redis 6+)
io-threads 4
io-threads-do-reads yes

# LFU SETTINGS for more accurate cache optimization
lfu-log-factor 10
lfu-decay-time 1

# HEALTH CHECK
# No timeout for connections
timeout 0
